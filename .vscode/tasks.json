/*
RESERVED GROUPS:
    - groupA
    - groupB
*/

{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Switch:TestingMode",
            "type": "shell",
            "command": "(Get-Content .env) -replace 'APP_ENV=.*', 'APP_ENV=testing' | Set-Content .env"
        },
        {
            "label": "Switch:DevelopmentMode",
            "type": "shell",
            "command": "(Get-Content .env) -replace 'APP_ENV=.*', 'APP_ENV=local' | Set-Content .env"
        },

        // ----------------------------------------------------------------

        {
            "label": "App:Laravel",
            "type": "shell",
            "command": "php artisan serve",
            "presentation": {
                "group": "groupA"
            }
        },
        {
            "label": "App:NPM",
            "type": "shell",
            "command": "npm run dev",
            "presentation": {
                "group": "groupA"
            }
        },
        {
            "label": "App:Websocket",
            "type": "shell",
            "command": "php artisan reverb:start",
            "presentation": {
                "group": "groupA"
            }
        },

        // Anticipate if using env.QUEUE_CONNECTION = database

        {
            "label": "App:ListenQueue",
            "type": "shell",
            "command": "php artisan queue:listen"
        },

        {
            "label": "App:Serve",
            "problemMatcher": [],
            "dependsOn": ["App:Laravel", "App:NPM", "App:Websocket"]
        },

        // ----------------------------------------------------------------

        {
            "label": "Install:ComposerDependencies",
            "type": "shell",
            "command": "composer install",
            "presentation": {
                "group": "groupB"
            }
        },
        {
            "label": "Install:NPMDependencies",
            "type": "shell",
            "command": "npm install",
            "presentation": {
                "group": "groupB"
            }
        },
        {
            "label": "Storage:Link",
            "type": "shell",
            "command": "php artisan storage:link"
        },
        {
            "label": "Install Dependencies",
            "problemMatcher": [],
            "dependsOn": [
                "Install:ComposerDependencies",
                "Install:NPMDependencies"
            ]
        },

        // ----------------------------------------------------------------

        {
            "label": "Run:LaravelIDEHelper",
            "problemMatcher": [],
            "type": "shell",
            "command": "composer ide-helper"
        },

        // ----------------------------------------------------------------

        {
            "label": "Database:Create",
            "type": "shell",
            "command": "php artisan db:create"
        },
        {
            "label": "Database:Migrate",
            "type": "shell",
            "command": "php artisan migrate --seed"
        },
        {
            "label": "Database:MigrateFresh",
            "type": "shell",
            "command": "php artisan migrate:fresh --seed"
        },
        {
            "label": "Database:Setup",
            "problemMatcher": [],
            "dependsOrder": "sequence",
            "dependsOn": ["Database:Create", "Database:Migrate"]
        },

        // ----------------------------------------------------------------

        {
            "label": "Run:LaravelPint",
            "problemMatcher": [],
            "type": "shell",
            "command": "./vendor/bin/pint"
        },

        // ----------------------------------------------------------------

        {
            "label": "App",
            "problemMatcher": [],
            "dependsOn": ["Switch:DevelopmentMode", "App:Serve"],
            "dependsOrder": "sequence"
        }
    ]
}
